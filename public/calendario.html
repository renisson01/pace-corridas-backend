<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PACE - CalendÃ¡rio de Corridas Brasil 2025</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen">
<div class="max-w-5xl mx-auto p-4">

  <div class="text-center py-6">
    <h1 class="text-3xl font-black">ğŸ“… CalendÃ¡rio de Corridas 2025</h1>
    <p class="text-slate-400 mt-1">Todas as corridas do Brasil com links de inscriÃ§Ã£o</p>
    <div class="flex justify-center gap-4 mt-2 text-sm">
      <a href="/" class="text-blue-400 underline">InÃ­cio</a>
      <a href="/resultados.html" class="text-blue-400 underline">Ranking</a>
      <a href="/importar-resultado.html" class="text-blue-400 underline">Importar</a>
    </div>
  </div>

  <!-- FILTROS -->
  <div class="bg-slate-800 rounded-xl p-4 mb-6 flex flex-wrap gap-3">
    <select id="filtroEstado" onchange="filtrar()" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
      <option value="">ğŸ‡§ğŸ‡· Todos os estados</option>
      <option value="SE">Sergipe</option>
      <option value="SP">SÃ£o Paulo</option>
      <option value="RJ">Rio de Janeiro</option>
      <option value="BA">Bahia</option>
      <option value="PE">Pernambuco</option>
      <option value="CE">CearÃ¡</option>
      <option value="MG">Minas Gerais</option>
      <option value="RS">Rio Grande do Sul</option>
      <option value="PR">ParanÃ¡</option>
      <option value="SC">Santa Catarina</option>
      <option value="DF">BrasÃ­lia</option>
      <option value="PA">ParÃ¡</option>
      <option value="AM">Amazonas</option>
    </select>
    <select id="filtroStatus" onchange="filtrar()" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
      <option value="">Todas</option>
      <option value="upcoming">PrÃ³ximas</option>
      <option value="completed">Realizadas</option>
    </select>
    <select id="filtroDist" onchange="filtrar()" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
      <option value="">Todas distÃ¢ncias</option>
      <option value="42km">Maratona 42km</option>
      <option value="21km">Meia 21km</option>
      <option value="10km">10km</option>
      <option value="5km">5km</option>
    </select>
    <div id="totalFiltro" class="ml-auto text-sm text-slate-400 self-center"></div>
  </div>

  <div id="grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  <div id="loading" class="text-center py-12 text-slate-400">â³ Carregando...</div>
</div>

<script>
let todasCorridas = [];

const ESTADO_NOME = {SP:'SÃ£o Paulo',RJ:'Rio de Janeiro',SE:'Sergipe',BA:'Bahia',MG:'Minas Gerais',RS:'Rio Grande do Sul',PR:'ParanÃ¡',SC:'Santa Catarina',PE:'Pernambuco',CE:'CearÃ¡',DF:'BrasÃ­lia',GO:'GoiÃ¡s',MS:'Mato Grosso do Sul',PA:'ParÃ¡',AM:'Amazonas',AL:'Alagoas',RN:'Rio Grande do Norte'};

async function load() {
  const races = await fetch('/races').then(r=>r.json()).catch(()=>[]);
  todasCorridas = races.sort((a,b)=>new Date(a.date)-new Date(b.date));
  document.getElementById('loading').classList.add('hidden');
  filtrar();
}

function filtrar() {
  const estado = document.getElementById('filtroEstado').value;
  const status = document.getElementById('filtroStatus').value;
  const dist = document.getElementById('filtroDist').value;

  let filtradas = todasCorridas;
  if(estado) filtradas = filtradas.filter(r=>r.state===estado);
  if(status) filtradas = filtradas.filter(r=>r.status===status);
  if(dist) filtradas = filtradas.filter(r=>r.distances?.includes(dist));

  document.getElementById('totalFiltro').textContent = filtradas.length + ' corridas';
  renderGrid(filtradas);
}

function renderGrid(corridas) {
  const hoje = new Date();
  document.getElementById('grid').innerHTML = corridas.map(r => {
    const data = new Date(r.date);
    const passada = data < hoje;
    const diasFaltam = Math.ceil((data-hoje)/(1000*60*60*24));
    const distancias = (r.distances||'').split(',').map(d=>d.trim()).filter(Boolean);

    return `<div class="bg-slate-800 rounded-xl p-5 flex flex-col gap-3 hover:bg-slate-750 transition">
      <div class="flex justify-between items-start">
        <div>
          <span class="text-xs font-bold px-2 py-0.5 rounded-full ${passada?'bg-slate-600 text-slate-300':'bg-green-500/20 text-green-400'}">
            ${passada ? 'âœ… Realizada' : diasFaltam<=7?'ğŸ”¥ Esta semana':diasFaltam<=30?'ğŸ“Œ Este mÃªs':'ğŸ“… '+diasFaltam+' dias'}
          </span>
        </div>
        <span class="text-xs text-slate-500 font-bold">${r.state}</span>
      </div>

      <div>
        <h3 class="font-black text-sm leading-tight">${r.name}</h3>
        <p class="text-slate-400 text-xs mt-1">ğŸ“ ${r.city} Â· ${data.toLocaleDateString('pt-BR',{day:'2-digit',month:'long',year:'numeric'})}</p>
      </div>

      <div class="flex flex-wrap gap-1">
        ${distancias.map(d=>`<span class="text-xs bg-blue-900/50 text-blue-300 px-2 py-0.5 rounded-full">${d}</span>`).join('')}
      </div>

      ${r.organizer?`<p class="text-xs text-slate-500">ğŸ¢ ${r.organizer}</p>`:''}

      <div class="mt-auto pt-2 border-t border-slate-700">
        ${r.registrationUrl && !passada
          ? `<a href="${r.registrationUrl}" target="_blank"
              class="block w-full text-center bg-green-500 hover:bg-green-400 text-black py-2 rounded-lg text-sm font-black transition">
              ğŸƒ Inscrever-se
            </a>`
          : passada
            ? `<a href="/resultados.html" class="block w-full text-center bg-slate-600 hover:bg-slate-500 py-2 rounded-lg text-sm font-bold transition">
                ğŸ† Ver resultados
              </a>`
            : `<span class="block w-full text-center text-slate-500 text-xs py-2">Link de inscriÃ§Ã£o em breve</span>`
        }
      </div>
    </div>`;
  }).join('') || '<div class="col-span-3 text-center py-12 text-slate-400">Nenhuma corrida encontrada</div>';
}

load();
</script>
</body>
</html>
