<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PACE â€” Ranking Elite Brasil</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#0f172a;}
.card{animation:fadeIn .2s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body class="text-white min-h-screen pb-24">

<header class="bg-slate-800 border-b border-slate-700 sticky top-0 z-40 px-4 py-3 flex items-center gap-3">
  <a href="/" class="text-green-400 font-black text-xl">PACE</a>
  <div class="flex-1 text-center">
    <p class="font-black text-sm">ğŸ† Ranking Elite Brasil</p>
    <p id="subtitulo" class="text-xs text-slate-400">Melhor tempo por atleta</p>
  </div>
</header>

<!-- TABS DISTÃ‚NCIA -->
<div class="bg-slate-800 border-b border-slate-700 px-4 py-2 overflow-x-auto flex gap-2">
  <button onclick="load('geral')"  id="tab-geral"  class="tab whitespace-nowrap bg-green-500 text-black font-black text-xs px-4 py-2 rounded-full">ğŸ† Geral</button>
  <button onclick="load('42km')"   id="tab-42km"   class="tab whitespace-nowrap bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2 rounded-full">42km</button>
  <button onclick="load('21km')"   id="tab-21km"   class="tab whitespace-nowrap bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2 rounded-full">21km</button>
  <button onclick="load('15km')"   id="tab-15km"   class="tab whitespace-nowrap bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2 rounded-full">15km</button>
  <button onclick="load('10km')"   id="tab-10km"   class="tab whitespace-nowrap bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2 rounded-full">10km</button>
</div>

<!-- FILTRO GÃŠNERO -->
<div class="px-4 py-2 flex gap-2">
  <button onclick="setGenero('')"  id="gen-"  class="text-xs bg-green-500 text-black font-black px-3 py-1.5 rounded-full">Todos</button>
  <button onclick="setGenero('M')" id="gen-M" class="text-xs bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full">ğŸ‘¨ Masc</button>
  <button onclick="setGenero('F')" id="gen-F" class="text-xs bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full">ğŸ‘© Fem</button>
  <div class="ml-auto flex items-center gap-2 text-xs text-slate-400" id="total-tag"></div>
</div>

<div class="max-w-2xl mx-auto px-4 space-y-2 pb-4">
  <div id="loading" class="text-center py-12 text-slate-400 text-4xl">â³</div>
  <div id="lista" class="space-y-2 hidden"></div>
  <div id="vazio" class="hidden text-center py-12">
    <p class="text-slate-400">Nenhum resultado nessa distÃ¢ncia ainda</p>
  </div>
</div>

<nav class="fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 flex justify-around py-2 z-50">
  <a href="/" class="flex flex-col items-center text-xs text-slate-400 py-1 px-3"><span class="text-xl">ğŸ </span><span>InÃ­cio</span></a>
  <a href="/calendario.html" class="flex flex-col items-center text-xs text-slate-400 py-1 px-3"><span class="text-xl">ğŸ“…</span><span>Corridas</span></a>
  <a href="/elite.html" class="flex flex-col items-center text-xs text-green-400 py-1 px-3"><span class="text-xl">ğŸ†</span><span>Ranking</span></a>
  <a href="/social.html" class="flex flex-col items-center text-xs text-slate-400 py-1 px-3"><span class="text-xl">ğŸ“¸</span><span>Feed</span></a>
  <a href="/perfil.html" class="flex flex-col items-center text-xs text-slate-400 py-1 px-3"><span class="text-xl">ğŸ‘¤</span><span>Perfil</span></a>
</nav>

<script>
let abaAtual = 'geral', generoAtual = '', dados = [];
const ICONE = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
const NIVEL = {
  'â­ Elite Mundial':  {bg:'border-yellow-500/40 bg-yellow-900/20', txt:'text-yellow-400'},
  'ğŸ”¥ Elite Nacional': {bg:'border-orange-500/40 bg-orange-900/20', txt:'text-orange-400'},
  'ğŸ’ª Elite Regional': {bg:'border-blue-500/40 bg-blue-900/20',    txt:'text-blue-400'},
  'ğŸ“ˆ Sub-Elite':      {bg:'border-green-500/40 bg-green-900/20',  txt:'text-green-400'},
  'ğŸŒ± AvanÃ§ado':       {bg:'border-slate-600 bg-slate-800',        txt:'text-slate-400'},
};

function card(a, i) {
  const n = NIVEL[a.nivel] || NIVEL['ğŸŒ± AvanÃ§ado'];
  const pos = i < 3 ? ICONE[i] : `<span class="font-black text-slate-400 text-sm">${i+1}Â°</span>`;
  const tempo = a.melhorTempo || null;
  const info = [
    a.equipe ? `ğŸƒ ${a.equipe}` : '',
    a.state  ? `ğŸ“ ${a.state}` : '',
    a.gender === 'M' ? 'ğŸ‘¨' : a.gender === 'F' ? 'ğŸ‘©' : '',
  ].filter(Boolean).join(' Â· ');

  return `<div class="card border ${n.bg} rounded-2xl p-4 flex items-center gap-3">
    <div class="w-10 h-10 rounded-full bg-slate-700/50 flex items-center justify-center flex-shrink-0 text-xl">${pos}</div>
    <div class="flex-1 min-w-0">
      <p class="font-black text-sm leading-tight">${a.name}</p>
      ${info ? `<p class="text-xs text-slate-400 mt-0.5 truncate">${info}</p>` : ''}
      <span class="text-xs ${n.txt} font-bold">${a.nivel}</span>
    </div>
    <div class="text-right flex-shrink-0">
      ${tempo
        ? `<p class="font-black text-green-400 text-base">${tempo}</p><p class="text-xs text-slate-400">melhor tempo</p>`
        : `<p class="font-black text-green-400">${(a.totalPoints||0).toLocaleString('pt-BR')}</p><p class="text-xs text-slate-400">${a.totalRaces||0} provas</p>`}
    </div>
  </div>`;
}

async function load(aba) {
  abaAtual = aba;
  document.getElementById('loading').classList.remove('hidden');
  document.getElementById('lista').classList.add('hidden');
  document.getElementById('vazio').classList.add('hidden');

  // Atualizar tabs
  document.querySelectorAll('.tab').forEach(b => {
    b.className = 'tab whitespace-nowrap bg-slate-700 text-slate-300 text-xs font-bold px-4 py-2 rounded-full';
  });
  document.getElementById(`tab-${aba}`).className = 'tab whitespace-nowrap bg-green-500 text-black font-black text-xs px-4 py-2 rounded-full';

  try {
    let url = aba === 'geral' ? '/ranking' : `/ranking/${aba}`;
    if (generoAtual) url += `?genero=${generoAtual}`;
    const r = await fetch(url);
    dados = await r.json();
    if (!Array.isArray(dados)) dados = [];
    render();
  } catch(e) {
    document.getElementById('loading').innerHTML = `<p class="text-red-400 text-sm">âŒ ${e.message}</p>`;
  }
}

function render() {
  document.getElementById('loading').classList.add('hidden');
  const sub = abaAtual === 'geral' ? 'Pontos acumulados' : `Melhor tempo em ${abaAtual}`;
  document.getElementById('subtitulo').textContent = sub;
  document.getElementById('total-tag').textContent = dados.length ? `${dados.length} atletas` : '';

  if (!dados.length) {
    document.getElementById('vazio').classList.remove('hidden');
    return;
  }
  document.getElementById('lista').classList.remove('hidden');
  document.getElementById('lista').innerHTML = dados.map((a,i) => card(a,i)).join('');
}

function setGenero(g) {
  generoAtual = g;
  document.querySelectorAll('[id^="gen-"]').forEach(b => {
    b.className = 'text-xs bg-slate-700 text-slate-300 px-3 py-1.5 rounded-full';
  });
  document.getElementById(`gen-${g}`).className = 'text-xs bg-green-500 text-black font-black px-3 py-1.5 rounded-full';
  load(abaAtual);
}

load('geral');
</script>
</body>
</html>
