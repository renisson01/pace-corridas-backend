<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PACE ‚Äî Admin Loja</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>body{background:#0f172a;}</style>
</head>
<body class="text-white min-h-screen pb-24">
<header class="bg-slate-800 border-b border-slate-700 px-4 py-3 flex items-center gap-3">
  <a href="/loja.html" class="text-slate-400">‚Üê</a>
  <h1 class="font-black">‚öôÔ∏è Admin Loja</h1>
</header>

<div class="max-w-lg mx-auto px-4 py-4">
  <!-- TABS -->
  <div class="flex gap-2 mb-4">
    <button onclick="showTab('produtos')" class="tab-btn bg-green-500 text-black font-black text-sm px-4 py-2 rounded-full">üëï Produtos</button>
    <button onclick="showTab('assessorias')" class="tab-btn bg-slate-700 text-slate-300 text-sm font-bold px-4 py-2 rounded-full">üèÉ Assessorias</button>
  </div>

  <!-- PRODUTOS -->
  <div id="tab-produtos">
    <button onclick="showForm('produto')" class="w-full bg-green-500 text-black font-black py-3 rounded-xl mb-4">+ Novo Produto</button>
    <div id="formProduto" class="hidden bg-slate-800 border border-slate-700 rounded-2xl p-4 mb-4">
      <h3 class="font-black mb-3">Novo Produto</h3>
      <div class="space-y-3">
        <input id="pNome" placeholder="Nome do produto" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <textarea id="pDesc" placeholder="Descri√ß√£o" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none resize-none" rows="2"></textarea>
        <div class="grid grid-cols-2 gap-3">
          <input id="pPreco" type="number" step="0.01" placeholder="Pre√ßo R$" class="bg-slate-700 border border-slate-600 rounded-xl px-3 py-2.5 text-sm text-white outline-none">
          <input id="pEstoque" type="number" placeholder="Estoque" class="bg-slate-700 border border-slate-600 rounded-xl px-3 py-2.5 text-sm text-white outline-none">
        </div>
        <input id="pTamanhos" placeholder="Tamanhos: PP,P,M,G,GG,XG" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <select id="pCategoria" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
          <option value="camisa">üëï Camisa Assessoria</option>
          <option value="clube">üèÜ Camisa Clube</option>
          <option value="avulso">üëü Modelo Avulso</option>
        </select>
        <select id="pAssessoria" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
          <option value="">Sem assessoria (modelo avulso)</option>
        </select>
        <div>
          <p class="text-xs text-slate-400 mb-2">Fotos (URLs separadas por v√≠rgula)</p>
          <input id="pFotos" placeholder="https://... , https://..." class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
          <p class="text-xs text-slate-500 mt-1">Em breve: upload direto de foto</p>
        </div>
        <button onclick="criarProduto()" class="w-full bg-green-500 text-black font-black py-3 rounded-xl">Salvar Produto</button>
      </div>
    </div>
    <div id="listaProdutos" class="space-y-2"></div>
  </div>

  <!-- ASSESSORIAS -->
  <div id="tab-assessorias" class="hidden">
    <button onclick="showForm('assessoria')" class="w-full bg-green-500 text-black font-black py-3 rounded-xl mb-4">+ Nova Assessoria/Clube</button>
    <div id="formAssessoria" class="hidden bg-slate-800 border border-slate-700 rounded-2xl p-4 mb-4">
      <h3 class="font-black mb-3">Nova Assessoria</h3>
      <div class="space-y-3">
        <input id="aNome" placeholder="Nome da assessoria" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <div class="grid grid-cols-2 gap-3">
          <input id="aCidade" placeholder="Cidade" class="bg-slate-700 border border-slate-600 rounded-xl px-3 py-2.5 text-sm text-white outline-none">
          <select id="aEstado" class="bg-slate-700 border border-slate-600 rounded-xl px-3 py-2.5 text-sm text-white outline-none">
            <option value="SE">SE</option><option value="SP">SP</option><option value="RJ">RJ</option>
            <option value="MG">MG</option><option value="BA">BA</option><option value="PE">PE</option>
            <option value="CE">CE</option><option value="PR">PR</option>
          </select>
        </div>
        <textarea id="aDesc" placeholder="Descri√ß√£o" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none resize-none" rows="2"></textarea>
        <input id="aInsta" placeholder="Instagram @" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <input id="aWhats" placeholder="WhatsApp (s√≥ n√∫meros)" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <input id="aFundacao" placeholder="Ano de funda√ß√£o" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <input id="aLogo" placeholder="URL do logo" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-2.5 text-sm text-white outline-none">
        <button onclick="criarAssessoria()" class="w-full bg-green-500 text-black font-black py-3 rounded-xl">Salvar Assessoria</button>
      </div>
    </div>
    <div id="listaAssessorias" class="space-y-2"></div>
  </div>
</div>

<script>
const token = localStorage.getItem('pace_token');
const me = localStorage.getItem('pace_user') ? JSON.parse(localStorage.getItem('pace_user')) : null;
if (!token || !me?.isAdmin) { alert('Acesso negado!'); window.location.href='/'; }

function showTab(tab) {
  ['produtos','assessorias'].forEach(t => {
    document.getElementById(`tab-${t}`).classList.toggle('hidden', t !== tab);
  });
  document.querySelectorAll('.tab-btn').forEach(b => {
    b.className = 'tab-btn bg-slate-700 text-slate-300 text-sm font-bold px-4 py-2 rounded-full';
  });
  event.target.className = 'tab-btn bg-green-500 text-black font-black text-sm px-4 py-2 rounded-full';
  if (tab === 'produtos') loadProdutos();
  if (tab === 'assessorias') loadAssessorias();
}

function showForm(tipo) {
  document.getElementById(`form${tipo.charAt(0).toUpperCase()+tipo.slice(1)}`).classList.toggle('hidden');
}

async function loadAssessorias() {
  const r = await fetch('/assessorias');
  const lista = await r.json();
  
  // Preencher select de assessorias no form de produto
  const sel = document.getElementById('pAssessoria');
  sel.innerHTML = '<option value="">Sem assessoria (modelo avulso)</option>' +
    lista.map(a => `<option value="${a.id}">${a.nome}</option>`).join('');
  
  document.getElementById('listaAssessorias').innerHTML = lista.map(a => `
    <div class="bg-slate-800 border border-slate-700 rounded-xl p-3 flex justify-between items-center">
      <div>
        <p class="font-bold text-sm">${a.nome}</p>
        <p class="text-xs text-slate-400">${a.cidade}/${a.estado}</p>
      </div>
      <a href="/assessoria.html?slug=${a.slug}" class="text-green-400 text-xs">Ver ‚Üí</a>
    </div>`).join('');
}

async function loadProdutos() {
  const r = await fetch('/loja/produtos');
  const lista = await r.json();
  document.getElementById('listaProdutos').innerHTML = lista.map(p => `
    <div class="bg-slate-800 border border-slate-700 rounded-xl p-3 flex justify-between items-center">
      <div>
        <p class="font-bold text-sm">${p.nome}</p>
        <p class="text-xs text-green-400">R$ ${p.preco.toFixed(2)}</p>
        <p class="text-xs text-slate-400">${p.tamanhos}</p>
      </div>
      <div class="text-right">
        ${p.assessoria ? `<p class="text-xs text-blue-400">${p.assessoria.nome}</p>` : ''}
        <p class="text-xs text-slate-500">Estoque: ${p.estoque}</p>
      </div>
    </div>`).join('') || '<p class="text-slate-400 text-sm text-center py-4">Nenhum produto cadastrado</p>';
}

async function criarAssessoria() {
  const data = {
    nome: document.getElementById('aNome').value,
    cidade: document.getElementById('aCidade').value,
    estado: document.getElementById('aEstado').value,
    descricao: document.getElementById('aDesc').value,
    instagram: document.getElementById('aInsta').value,
    whatsapp: document.getElementById('aWhats').value,
    fundacao: document.getElementById('aFundacao').value,
    logo: document.getElementById('aLogo').value,
  };
  if (!data.nome || !data.cidade) return alert('Nome e cidade obrigat√≥rios!');
  const r = await fetch('/assessorias', {
    method: 'POST',
    headers: { 'Content-Type':'application/json', Authorization:`Bearer ${token}` },
    body: JSON.stringify(data)
  });
  const d = await r.json();
  if (d.id) { alert('‚úÖ Assessoria criada!'); loadAssessorias(); showForm('assessoria'); }
  else alert(d.error || 'Erro');
}

async function criarProduto() {
  const data = {
    nome: document.getElementById('pNome').value,
    descricao: document.getElementById('pDesc').value,
    preco: document.getElementById('pPreco').value,
    estoque: document.getElementById('pEstoque').value,
    tamanhos: document.getElementById('pTamanhos').value,
    categoria: document.getElementById('pCategoria').value,
    assessoriaId: document.getElementById('pAssessoria').value || null,
    fotos: document.getElementById('pFotos').value,
  };
  if (!data.nome || !data.preco) return alert('Nome e pre√ßo obrigat√≥rios!');
  const r = await fetch('/loja/produtos', {
    method: 'POST',
    headers: { 'Content-Type':'application/json', Authorization:`Bearer ${token}` },
    body: JSON.stringify(data)
  });
  const d = await r.json();
  if (d.id) { alert('‚úÖ Produto criado!'); loadProdutos(); showForm('produto'); }
  else alert(d.error || 'Erro');
}

loadProdutos();
loadAssessorias();
</script>
</body>
</html>
