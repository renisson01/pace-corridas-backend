<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>PACE â€” Loja Oficial</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#0a0f1a;}
.grad{background:linear-gradient(135deg,#22c55e,#16a34a);}
.card-glass{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);}
::-webkit-scrollbar{display:none;}
</style>
</head>
<body class="text-white min-h-screen pb-24">

<header class="sticky top-0 z-40 px-4 py-3 flex items-center gap-3" style="background:rgba(10,15,26,0.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.08);">
  <a href="/" class="text-slate-400 text-xl">â†</a>
  <div class="flex-1">
    <h1 class="font-black text-lg leading-none">ğŸ‘• Loja PACE</h1>
    <p class="text-xs text-slate-400">Camisas oficiais para corredores</p>
  </div>
  <a href="https://www.instagram.com/estampacecamisetas" target="_blank"
    class="flex items-center gap-1.5 text-xs px-3 py-2 rounded-xl font-bold"
    style="background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);color:white;">
    ğŸ“¸ Instagram
  </a>
</header>

<!-- BANNER INSTAGRAM -->
<div class="mx-4 mt-4 rounded-2xl overflow-hidden" style="background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);">
  <a href="https://www.instagram.com/estampacecamisetas" target="_blank" class="flex items-center gap-3 p-4">
    <div class="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center text-2xl">ğŸ“¸</div>
    <div class="flex-1">
      <p class="font-black text-sm">@estampacecamisetas</p>
      <p class="text-xs text-white/80">Veja nossos modelos no Instagram</p>
    </div>
    <span class="text-white/80 text-lg">â†’</span>
  </a>
</div>

<!-- FILTROS -->
<div class="px-4 mt-4 flex gap-2 overflow-x-auto pb-1">
  <button onclick="filtrar('')"         id="f-"        class="filtro whitespace-nowrap text-xs font-black bg-green-500 text-black px-4 py-2 rounded-full">Todos</button>
  <button onclick="filtrar('camisa')"   id="f-camisa"  class="filtro whitespace-nowrap text-xs bg-slate-800 border border-slate-700 text-slate-300 px-4 py-2 rounded-full">ğŸ‘• Camisas</button>
  <button onclick="filtrar('shorts')"   id="f-shorts"  class="filtro whitespace-nowrap text-xs bg-slate-800 border border-slate-700 text-slate-300 px-4 py-2 rounded-full">ğŸ©³ Shorts</button>
  <button onclick="filtrar('bone')"     id="f-bone"    class="filtro whitespace-nowrap text-xs bg-slate-800 border border-slate-700 text-slate-300 px-4 py-2 rounded-full">ğŸ§¢ BonÃ©s</button>
  <button onclick="filtrar('acessorio')" id="f-acessorio" class="filtro whitespace-nowrap text-xs bg-slate-800 border border-slate-700 text-slate-300 px-4 py-2 rounded-full">âŒš AcessÃ³rios</button>
</div>

<!-- PRODUTOS -->
<div class="px-4 mt-4 pb-4">
  <div id="produtos" class="grid grid-cols-2 gap-3">
    <div class="card-glass rounded-2xl p-4 animate-pulse col-span-2 h-32"></div>
  </div>
  <div id="vazio" class="hidden text-center py-12">
    <p class="text-5xl mb-3">ğŸ‘•</p>
    <p class="font-black text-lg mb-1">Em breve!</p>
    <p class="text-slate-400 text-sm mb-4">Estamos preparando os produtos. Veja os modelos no Instagram!</p>
    <a href="https://www.instagram.com/estampacecamisetas" target="_blank"
      class="inline-block px-6 py-3 rounded-2xl font-black text-white text-sm"
      style="background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);">
      ğŸ“¸ Ver no Instagram
    </a>
  </div>
</div>

<!-- MODAL PRODUTO -->
<div id="modal" class="fixed inset-0 z-50 hidden items-end justify-center" style="background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);">
  <div class="w-full max-w-lg rounded-t-3xl overflow-hidden" style="background:#111827;border-top:1px solid rgba(255,255,255,0.1);max-height:90vh;overflow-y:auto;">
    <div class="flex justify-center pt-3 pb-1"><div class="w-10 h-1 bg-slate-700 rounded-full"></div></div>
    <div id="modal-content" class="p-5"></div>
  </div>
</div>

<nav class="fixed bottom-0 left-0 right-0 z-50" style="background:rgba(10,15,26,0.95);backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,0.08);">
  <div class="flex justify-around py-2">
    <a href="/" class="flex flex-col items-center text-xs text-slate-500 py-1 px-3"><span class="text-xl">ğŸ </span><span>InÃ­cio</span></a>
    <a href="/calendario.html" class="flex flex-col items-center text-xs text-slate-500 py-1 px-3"><span class="text-xl">ğŸ“…</span><span>Corridas</span></a>
    <a href="/elite.html" class="flex flex-col items-center text-xs text-slate-500 py-1 px-3"><span class="text-xl">ğŸ†</span><span>Ranking</span></a>
    <a href="/loja.html" class="flex flex-col items-center text-xs text-green-400 py-1 px-3"><span class="text-xl">ğŸ‘•</span><span class="font-bold">Loja</span></a>
    <a href="/ia.html" class="flex flex-col items-center text-xs text-slate-500 py-1 px-3"><span class="text-xl">ğŸƒ</span><span>IA</span></a>
    <a href="/perfil.html" class="flex flex-col items-center text-xs text-slate-500 py-1 px-3"><span class="text-xl">ğŸ‘¤</span><span>Perfil</span></a>
  </div>
</nav>

<script>
const token = localStorage.getItem('pace_token');
const WPP = '5579998020798';
let todos = [], catAtual = '';

async function carregarProdutos() {
  try {
    const r = await fetch('/loja/produtos');
    todos = await r.json() || [];
    renderizar();
  } catch { renderizar(); }
}

function filtrar(cat) {
  catAtual = cat;
  document.querySelectorAll('.filtro').forEach(b => {
    b.className = 'filtro whitespace-nowrap text-xs bg-slate-800 border border-slate-700 text-slate-300 px-4 py-2 rounded-full';
  });
  const id = 'f-' + cat;
  const el = document.getElementById(id);
  if (el) el.className = 'filtro whitespace-nowrap text-xs font-black bg-green-500 text-black px-4 py-2 rounded-full';
  renderizar();
}

function renderizar() {
  const lista = catAtual ? todos.filter(p => p.categoria === catAtual) : todos;
  const el = document.getElementById('produtos');
  if (!lista.length) {
    el.innerHTML = '';
    document.getElementById('vazio').classList.remove('hidden');
    return;
  }
  document.getElementById('vazio').classList.add('hidden');
  el.innerHTML = lista.map(p => `
    <div onclick="abrirProduto('${p.id}')" class="card-glass rounded-2xl overflow-hidden cursor-pointer active:scale-95 transition-transform">
      <div class="w-full h-44 bg-slate-800 flex items-center justify-center overflow-hidden">
        ${p.imagem
          ? `<img src="${p.imagem}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<span class=\\'text-5xl\\'>ğŸ‘•</span>'">`
          : '<span class="text-5xl">ğŸ‘•</span>'}
      </div>
      <div class="p-3">
        <p class="font-black text-sm leading-tight">${p.nome}</p>
        <p class="text-green-400 font-bold text-sm mt-1">R$ ${parseFloat(p.preco||0).toFixed(2)}</p>
        <p class="text-xs text-slate-500 mt-0.5">${p.variantes?.length ? 'VÃ¡rios tamanhos' : ''}</p>
      </div>
    </div>`).join('');
}

function abrirProduto(id) {
  const p = todos.find(x => x.id === id);
  if (!p) return;

  const tamanhos = [...new Set(p.variantes?.map(v => v.tamanho) || [])];
  const cores = [...new Set(p.variantes?.map(v => v.cor) || [])];

  document.getElementById('modal-content').innerHTML = `
    <div class="w-full h-64 bg-slate-800 rounded-2xl flex items-center justify-center overflow-hidden mb-4">
      ${p.imagem ? `<img src="${p.imagem}" class="w-full h-full object-cover rounded-2xl">` : '<span class="text-8xl">ğŸ‘•</span>'}
    </div>
    <h2 class="font-black text-xl mb-1">${p.nome}</h2>
    <p class="text-green-400 font-black text-2xl mb-3">R$ ${parseFloat(p.preco||0).toFixed(2)}</p>
    ${p.descricao ? `<p class="text-slate-400 text-sm mb-4">${p.descricao}</p>` : ''}
    ${cores.length > 1 ? `
    <div class="mb-4">
      <p class="text-xs text-slate-400 font-bold mb-2">COR</p>
      <div class="flex gap-2 flex-wrap" id="cores-sel">
        ${cores.map((c,i) => `<button onclick="selecionarCor('${c}')" id="cor-${c}" class="cor-btn text-xs px-3 py-2 rounded-xl border ${i===0?'bg-green-500 text-black border-green-500':'bg-slate-800 border-slate-700 text-slate-300'}">${c}</button>`).join('')}
      </div>
    </div>` : ''}
    ${tamanhos.length ? `
    <div class="mb-4">
      <p class="text-xs text-slate-400 font-bold mb-2">TAMANHO</p>
      <div class="flex gap-2 flex-wrap" id="tam-sel">
        ${tamanhos.map((t,i) => `<button onclick="selecionarTam('${t}')" id="tam-${t}" class="tam-btn w-12 h-12 rounded-xl border text-sm font-bold ${i===0?'bg-green-500 text-black border-green-500':'bg-slate-800 border-slate-700 text-slate-300'}">${t}</button>`).join('')}
      </div>
    </div>` : ''}
    <button onclick="comprarWhatsApp('${p.id}','${p.nome}', ${p.preco})" class="w-full py-4 rounded-2xl font-black text-black text-base mb-3 active:scale-95 transition-all" style="background:linear-gradient(135deg,#25d366,#128c7e);">
      ğŸ’¬ Comprar pelo WhatsApp
    </button>
    <a href="https://www.instagram.com/estampacecamisetas" target="_blank" class="block w-full py-3 rounded-2xl font-bold text-white text-sm text-center" style="background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);">
      ğŸ“¸ Ver mais modelos no Instagram
    </a>`;

  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal').classList.add('flex');
}

let tamSel = '', corSel = '';
function selecionarTam(t) {
  tamSel = t;
  document.querySelectorAll('.tam-btn').forEach(b => b.className = 'tam-btn w-12 h-12 rounded-xl border text-sm font-bold bg-slate-800 border-slate-700 text-slate-300');
  const el = document.getElementById('tam-'+t);
  if (el) el.className = 'tam-btn w-12 h-12 rounded-xl border text-sm font-bold bg-green-500 text-black border-green-500';
}
function selecionarCor(c) {
  corSel = c;
  document.querySelectorAll('.cor-btn').forEach(b => b.className = 'cor-btn text-xs px-3 py-2 rounded-xl border bg-slate-800 border-slate-700 text-slate-300');
  const el = document.getElementById('cor-'+c);
  if (el) el.className = 'cor-btn text-xs px-3 py-2 rounded-xl border bg-green-500 text-black border-green-500';
}

async function comprarWhatsApp(produtoId, nome, preco) {
  const tam = tamSel || 'M';
  const cor = corSel || '';

  // Tentar MP Checkout Pro primeiro
  try {
    const btn = event?.target;
    if (btn) { btn.textContent = 'â³ Gerando pagamento...'; btn.disabled = true; }

    const r = await fetch('/pagamentos/loja', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ produtoId, tamanho: tam, cor, quantidade: 1 })
    });
    const d = await r.json();
    if (d.url) {
      window.open(d.url, '_blank');
      if (btn) { btn.textContent = 'ğŸ’¬ Comprar'; btn.disabled = false; }
      return;
    }
  } catch(e) { console.warn('MP indisponÃ­vel, usando WhatsApp'); }

  // Fallback: WhatsApp
  const msg = `OlÃ¡! Quero comprar pelo app PACE:\n\nğŸ‘• *${nome}*\nğŸ“ Tamanho: ${tam}${cor ? '\nğŸ¨ Cor: '+cor : ''}\nğŸ’° R$ ${parseFloat(preco).toFixed(2)}\n\nPode me ajudar?`;
  window.open(`https://wa.me/${WPP}?text=${encodeURIComponent(msg)}`, '_blank');
}

document.getElementById('modal').addEventListener('click', function(e) {
  if (e.target === this) {
    this.classList.add('hidden');
    this.classList.remove('flex');
  }
});

carregarProdutos();
</script>
</body>
</html>
