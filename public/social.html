<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PACE Social - Rede do Corredor</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen">
<div class="max-w-xl mx-auto p-4">

  <div class="text-center py-6">
    <h1 class="text-3xl font-bold">üèÉ PACE Social</h1>
    <p class="text-slate-400">A rede social do corredor de rua</p>
    <div class="flex justify-center gap-4 mt-2 text-sm">
      <a href="/" class="text-blue-400 underline">In√≠cio</a>
      <a href="/resultados.html" class="text-blue-400 underline">Resultados</a>
      <a href="/faixas.html" class="text-blue-400 underline">Faixas</a>
    </div>
  </div>

  <!-- TABS -->
  <div class="flex gap-2 mb-6 border-b border-slate-700">
    <button onclick="showTab('login')" id="tab-login" class="tab px-4 py-2 text-sm font-bold border-b-2 border-blue-500 text-blue-400">üîë Login</button>
    <button onclick="showTab('register')" id="tab-register" class="tab px-4 py-2 text-sm font-bold border-b-2 border-transparent text-slate-400">üìù Cadastro</button>
    <button onclick="showTab('tinder')" id="tab-tinder" class="tab px-4 py-2 text-sm font-bold border-b-2 border-transparent text-slate-400">üíö Parceiros</button>
    <button onclick="showTab('profile')" id="tab-profile" class="tab px-4 py-2 text-sm font-bold border-b-2 border-transparent text-slate-400">üë§ Perfil</button>
  </div>

  <!-- LOGIN -->
  <div id="tab-login-c">
    <div class="bg-slate-800 rounded-xl p-6">
      <h2 class="font-bold text-lg mb-4">üîë Entrar na sua conta</h2>
      <input id="loginEmail" placeholder="Seu email" class="w-full bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600 mb-3">
      <p class="text-slate-400 text-xs mb-1 text-center">‚Äî ou ‚Äî</p>
      <input id="loginKey" placeholder="Sua chave privada" class="w-full bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600 mb-4 font-mono">
      <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 rounded-lg py-2 font-bold">Entrar</button>
      <div id="loginMsg" class="mt-3 text-sm"></div>
    </div>
  </div>

  <!-- CADASTRO -->
  <div id="tab-register-c" class="hidden">
    <div class="bg-slate-800 rounded-xl p-6">
      <h2 class="font-bold text-lg mb-4">üìù Criar conta PACE</h2>
      <input id="regName" placeholder="Nome completo" class="w-full bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600 mb-3">
      <input id="regEmail" placeholder="Email" type="email" class="w-full bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600 mb-3">
      <div class="grid grid-cols-2 gap-3 mb-3">
        <input id="regAge" placeholder="Idade" type="number" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
        <select id="regGender" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
          <option value="M">Masculino</option>
          <option value="F">Feminino</option>
        </select>
      </div>
      <div class="grid grid-cols-2 gap-3 mb-4">
        <input id="regCity" placeholder="Cidade" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
        <input id="regState" placeholder="Estado (ex: SE)" maxlength="2" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
      </div>
      <button onclick="register()" class="w-full bg-green-600 hover:bg-green-700 rounded-lg py-2 font-bold">Criar Conta Gr√°tis</button>
      <div id="regMsg" class="mt-3 text-sm"></div>
    </div>
  </div>

  <!-- TINDER CORREDOR -->
  <div id="tab-tinder-c" class="hidden">
    <div class="bg-slate-800 rounded-xl p-4 mb-4">
      <h2 class="font-bold mb-3">üíö Encontrar parceiros de treino</h2>
      <div class="grid grid-cols-2 gap-3">
        <input id="tinderCity" placeholder="Sua cidade" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
        <select id="tinderGender" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
          <option value="">Todos</option>
          <option value="M">Masculino</option>
          <option value="F">Feminino</option>
        </select>
        <input id="tinderMinAge" placeholder="Idade m√≠n" type="number" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
        <input id="tinderMaxAge" placeholder="Idade m√°x" type="number" class="bg-slate-700 rounded-lg px-3 py-2 text-sm border border-slate-600">
      </div>
      <button onclick="buscarParceiros()" class="w-full mt-3 bg-green-600 hover:bg-green-700 rounded-lg py-2 font-bold">üîç Buscar</button>
    </div>
    <div id="tinderList"></div>
  </div>

  <!-- PERFIL -->
  <div id="tab-profile-c" class="hidden">
    <div id="profileContent">
      <div class="bg-slate-800 rounded-xl p-6 text-center">
        <p class="text-slate-400">Fa√ßa login para ver seu perfil</p>
      </div>
    </div>
  </div>

</div>
<script>
let currentUser = JSON.parse(localStorage.getItem('pace_user')||'null');

function showTab(t){
  ['login','register','tinder','profile'].forEach(x=>{
    document.getElementById('tab-'+x+'-c').classList.add('hidden');
    document.getElementById('tab-'+x).className='tab px-4 py-2 text-sm font-bold border-b-2 border-transparent text-slate-400';
  });
  document.getElementById('tab-'+t+'-c').classList.remove('hidden');
  document.getElementById('tab-'+t).className='tab px-4 py-2 text-sm font-bold border-b-2 border-blue-500 text-blue-400';
  if(t==='profile') loadProfile();
}

async function login(){
  const email=document.getElementById('loginEmail').value;
  const key=document.getElementById('loginKey').value;
  if(!email&&!key){document.getElementById('loginMsg').innerHTML='<p class="text-red-400">Digite email ou chave privada</p>';return;}
  const res=await fetch('/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:email||undefined,privateKey:key||undefined})});
  const d=await res.json();
  if(d.success){
    currentUser={...d.athlete,token:d.token};
    localStorage.setItem('pace_user',JSON.stringify(currentUser));
    document.getElementById('loginMsg').innerHTML='<p class="text-green-400">‚úÖ Bem-vindo, '+d.athlete.name+'!</p>';
    setTimeout(()=>showTab('profile'),1000);
  }else{
    document.getElementById('loginMsg').innerHTML='<p class="text-red-400">‚ùå '+d.error+'</p>';
  }
}

async function register(){
  const body={
    name:document.getElementById('regName').value,
    email:document.getElementById('regEmail').value,
    age:document.getElementById('regAge').value,
    gender:document.getElementById('regGender').value,
    city:document.getElementById('regCity').value,
    state:document.getElementById('regState').value.toUpperCase()
  };
  if(!body.name||!body.email){document.getElementById('regMsg').innerHTML='<p class="text-red-400">Nome e email obrigat√≥rios</p>';return;}
  const res=await fetch('/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const d=await res.json();
  if(d.success){
    document.getElementById('regMsg').innerHTML='<div class="bg-slate-700 rounded-lg p-4 mt-3"><p class="text-green-400 font-bold mb-2">‚úÖ Conta criada!</p><p class="text-yellow-400 text-xs font-bold mb-1">üîê SALVE SUA CHAVE PRIVADA:</p><p class="text-white text-xs font-mono bg-slate-900 p-2 rounded break-all">'+d.auth.privateKey+'</p><p class="text-red-400 text-xs mt-2">‚ö†Ô∏è Sem ela voc√™ perde acesso! N√£o compartilhe nunca!</p></div>';
    currentUser={...d.athlete,token:d.auth.token};
    localStorage.setItem('pace_user',JSON.stringify(currentUser));
  }else{
    document.getElementById('regMsg').innerHTML='<p class="text-red-400">‚ùå '+d.error+'</p>';
  }
}

async function loadProfile(){
  if(!currentUser){document.getElementById('profileContent').innerHTML='<div class="bg-slate-800 rounded-xl p-6 text-center"><p class="text-slate-400">Fa√ßa login primeiro</p><button onclick="showTab('login')" class="mt-3 bg-blue-600 px-4 py-2 rounded-lg text-sm">Entrar</button></div>';return;}
  const res=await fetch('/athletes/'+currentUser.id+'/profile');
  const d=await res.json();
  const a=d.athlete,s=d.stats;
  document.getElementById('profileContent').innerHTML=
    '<div class="bg-slate-800 rounded-xl p-6 mb-4">'+
    '<div class="flex items-center gap-4 mb-4">'+
    '<div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-2xl font-bold">'+a.name[0]+'</div>'+
    '<div><h2 class="font-bold text-xl">'+a.name+'</h2><p class="text-slate-400 text-sm">'+a.city+' - '+a.state+'</p><p class="text-slate-400 text-sm">'+a.age+' anos | '+( a.gender==='M'?'Masculino':'Feminino')+'</p>'+(a.premium?'<span class="bg-yellow-500 text-black text-xs px-2 py-0.5 rounded-full font-bold">‚≠ê PREMIUM</span>':'')+'</div></div>'+
    '<div class="grid grid-cols-3 gap-3 text-center">'+
    '<div class="bg-slate-700 rounded-lg p-3"><div class="text-2xl font-bold text-blue-400">'+s.totalRaces+'</div><div class="text-xs text-slate-400">Corridas</div></div>'+
    '<div class="bg-slate-700 rounded-lg p-3"><div class="text-2xl font-bold text-green-400">'+s.totalKm+'</div><div class="text-xs text-slate-400">km totais</div></div>'+
    '<div class="bg-slate-700 rounded-lg p-3"><div class="text-2xl font-bold text-yellow-400">'+s.podios+'</div><div class="text-xs text-slate-400">P√≥dios</div></div>'+
    '</div></div>'+
    '<div class="bg-slate-800 rounded-xl p-4 mb-4"><h3 class="font-bold mb-3">üîê Identidade Digital</h3><p class="text-xs text-slate-400 mb-1">Chave p√∫blica (compartilhe):</p><p class="text-xs font-mono bg-slate-900 p-2 rounded break-all text-green-400">'+(a.publicKey||'N√£o dispon√≠vel')+'</p></div>'+
    '<div class="bg-slate-800 rounded-xl p-4"><h3 class="font-bold mb-3">üìä √öltimas corridas</h3>'+
    (d.results.length===0?'<p class="text-slate-400 text-sm">Nenhum resultado ainda</p>':
    d.results.map(r=>'<div class="border-t border-slate-700 py-2 flex justify-between items-center"><div><p class="text-sm font-medium">'+r.race+'</p><p class="text-xs text-slate-400">'+r.city+' | '+r.distance+'</p></div><div class="text-right"><p class="font-mono font-bold text-green-400">'+r.time+'</p><p class="text-xs text-slate-400">#'+r.overallRank+' geral</p></div></div>').join(''))+
    '</div>'+
    '<button onclick="logout()" class="w-full mt-4 bg-red-800 hover:bg-red-700 rounded-lg py-2 text-sm">Sair</button>';
}

async function buscarParceiros(){
  const city=document.getElementById('tinderCity').value;
  const gender=document.getElementById('tinderGender').value;
  const minAge=document.getElementById('tinderMinAge').value;
  const maxAge=document.getElementById('tinderMaxAge').value;
  let url='/athletes/nearby?limit=20';
  if(city)url+='&city='+encodeURIComponent(city);
  if(gender)url+='&gender='+gender;
  if(minAge)url+='&minAge='+minAge;
  if(maxAge)url+='&maxAge='+maxAge;
  const athletes=await fetch(url).then(r=>r.json());
  const el=document.getElementById('tinderList');
  if(!athletes.length){el.innerHTML='<div class="bg-slate-800 rounded-xl p-8 text-center text-slate-400">Nenhum corredor encontrado nessa cidade</div>';return;}
  el.innerHTML=athletes.filter(a=>a.id!==currentUser?.id).map(a=>'<div class="bg-slate-800 rounded-xl p-4 mb-3 flex items-center gap-4"><div class="w-12 h-12 bg-'+(a.gender==='F'?'pink':'blue')+'-600 rounded-full flex items-center justify-center text-xl font-bold flex-shrink-0">'+a.name[0]+'</div><div class="flex-1"><p class="font-bold">'+a.name+'</p><p class="text-slate-400 text-sm">'+a.city+' | '+a.age+' anos</p><p class="text-xs text-slate-400">'+a.totalRaces+' corridas</p></div><button onclick="match(''+a.id+'')" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg text-sm font-bold">üíö Treinar</button></div>').join('');
}

async function match(targetId){
  if(!currentUser){alert('Fa√ßa login primeiro!');showTab('login');return;}
  const res=await fetch('/athletes/'+currentUser.id+'/match',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({targetId})});
  const d=await res.json();
  alert(d.message);
}

function logout(){
  currentUser=null;
  localStorage.removeItem('pace_user');
  showTab('login');
}

if(currentUser) showTab('profile');
</script>
</body>
</html>